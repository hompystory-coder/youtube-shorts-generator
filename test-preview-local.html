<!DOCTYPE html>
<html>
<head>
    <title>Voice Preview Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="p-8">
    <h1 class="text-2xl mb-4">ğŸ¤ Voice Preview Test</h1>
    
    <!-- Hidden API key inputs -->
    <input type="hidden" id="minimaxApiKey" value="test_key">
    <input type="hidden" id="minimaxGroupId" value="test_group">
    
    <!-- Voice select -->
    <select id="minimaxVoiceSelect" class="border p-2 mb-4">
        <option value="Friendly_Person">Friendly Person</option>
        <option value="Calm_Woman">Calm Woman</option>
    </select>
    
    <!-- Preview button -->
    <button id="previewVoiceBtn" onclick="previewVoice()" 
            class="bg-blue-500 text-white px-4 py-2 rounded">
        <i id="previewVoiceIcon" class="fas fa-play"></i>
        <span id="previewVoiceText">ìŒì„± ë¯¸ë¦¬ë“£ê¸°</span>
    </button>
    
    <!-- Audio element -->
    <audio id="voicePreviewAudio" class="hidden"></audio>
    
    <div id="output" class="mt-4 p-4 bg-gray-100"></div>
    
    <script>
        const API_BASE = 'https://youtube-shorts-generator.pages.dev';
        
        // Insert the previewVoice function from app.js
async function previewVoice() {
    console.log('ğŸ¤ Preview voice clicked');
    
    const voiceSelect = document.getElementById('minimaxVoiceSelect');
    const previewBtn = document.getElementById('previewVoiceBtn');
    const previewText = document.getElementById('previewVoiceText');
    const previewIcon = document.getElementById('previewVoiceIcon');
    const audioElement = document.getElementById('voicePreviewAudio');
    
    if (!voiceSelect) {
        alert('ìŒì„± ì„ íƒ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        return;
    }
    
    const selectedVoice = voiceSelect.value;
    
    // Get API keys from hidden inputs (loaded from mypage)
    const minimaxApiKey = document.getElementById('minimaxApiKey')?.value;
    const minimaxGroupId = document.getElementById('minimaxGroupId')?.value;
    
    if (!minimaxApiKey) {
        alert('âš ï¸ Minimax API í‚¤ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.\n\në§ˆì´í˜ì´ì§€ â†’ API í‚¤ íƒ­ì—ì„œ Minimax API í‚¤ë¥¼ ë¨¼ì € ì„¤ì •í•´ì£¼ì„¸ìš”.');
        return;
    }
    
    // Sample text for preview
    const sampleText = 'ì•ˆë…•í•˜ì„¸ìš”. ì´ê²ƒì€ ìŒì„± ë¯¸ë¦¬ë“£ê¸° ìƒ˜í”Œì…ë‹ˆë‹¤. ì„ íƒí•˜ì‹  ëª©ì†Œë¦¬ë¡œ ìœ íŠœë¸Œ ì‡¼ì¸ ê°€ ìƒì„±ë©ë‹ˆë‹¤.';
    
    try {
        // Disable button
        if (previewBtn) {
            previewBtn.disabled = true;
            previewText.textContent = 'ìƒì„± ì¤‘...';
            previewIcon.className = 'fas fa-spinner fa-spin';
        }
        
        console.log('ğŸ¤ Calling voice preview API...');
        
        const response = await fetch(`${API_BASE}/api/voice/preview`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                text: sampleText,
                voice: selectedVoice,
                apiKey: minimaxApiKey,
                groupId: minimaxGroupId
            })
        });
        
        const data = await response.json();
        
        if (!data.success) {
            throw new Error(data.error || 'ìŒì„± ìƒì„± ì‹¤íŒ¨');
        }
        
        console.log('âœ… Voice preview generated:', data.data.audioUrl);
        
        // Play audio
        if (audioElement && data.data.audioUrl) {
            audioElement.src = data.data.audioUrl;
            audioElement.play();
            
            // Update button to stop state
            previewText.textContent = 'ì¬ìƒ ì¤‘...';
            previewIcon.className = 'fas fa-stop';
            
            // Reset button when audio ends
            audioElement.onended = () => {
                previewText.textContent = 'ìŒì„± ë¯¸ë¦¬ë“£ê¸°';
                previewIcon.className = 'fas fa-play';
                if (previewBtn) previewBtn.disabled = false;
            };
        } else {
            throw new Error('ì˜¤ë””ì˜¤ URLì„ ë°›ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.');
        }
        
    } catch (error) {
        console.error('âŒ Voice preview error:', error);
        alert('ìŒì„± ë¯¸ë¦¬ë“£ê¸° ì‹¤íŒ¨: ' + error.message);
        
        // Reset button
        if (previewBtn) {
            previewBtn.disabled = false;
            previewText.textContent = 'ìŒì„± ë¯¸ë¦¬ë“£ê¸°';
            previewIcon.className = 'fas fa-play';
        }
    }
}
        
        console.log('âœ… Test page loaded');
        document.getElementById('output').innerHTML = '<p>Function loaded. Check console for logs.</p>';
    </script>
</body>
</html>
